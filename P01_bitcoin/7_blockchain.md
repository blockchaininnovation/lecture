# ブロックチェーン

## 概要
- ブロックチェーンの構造の説明
    - ブロック + チェーン
- ブロック内に入ってるデータ
- ブロック識別し
- Genesis ブロック
- マークルツリー

# ブロックの連鎖

## ブロックの構造
- ブロックサイズ
    - このフィールドを含まないこのブロックのサイズ
- ブロックヘッダー
    - 前ブロックハッシュ
    - difficulty
    - マークルルート
    - nance
- トランザクション数
    - このブロックに含まれるトランザクション数
- トランザクション
- ブロックハッシ

## ブロックの連鎖
- 前ブロックのハッシュ値が自身のブロックに含まれる
- このように最初のブロック(genesis block)にまで連鎖状に連なっている

## ブロックハッシュによる改ざん困難さ
- まずは改ざんしようとしているトランザクションを含むブロックの検証を通るようにしなければならない→新たなナンス値を求める必要性
- それができたとしても次のブロックに含まれるハッシュ値と相違してしまうため，つながらなくなる
- 最長ブロックのチェーンを選択するようになっているため連鎖的にそのブロック以降のナンス値をすべて改めて求めていく必要が出てしまう．

## ブロックの連鎖：詳細
- ブロックサイズ
    - 4bytes
    - トランザクション座椅子は最低250バイト
    - １つのブロックには平均1900トランザクションが含まれる
    - 1MB以下にならなければならない
- ブロックヘッダー
    - Version
        - 4 bytes
        - ソフトウェア、プロトコルバージョン情報
    - Previous BlockHash
        - 32 bytes
        - 前ブロックのブロックハッシュ
    - Markle Root
        - 32 bytes
        - 武特区の前トランザクションに対するマークルルリーのルートハッシュ
    - Time Stamp
        - 4bytes
        - ブロックの生成時刻
    - Difficulty Target
        - 4bytes
        - ブロック生成時のPoWのdifficulty
    - Nonce
        - 4bytes
        - ナンス値

## ブロック識別子：ブロックヘッダハッシュとブロック高
【目的】
- 各ブロックをユニークに識別する
    - ブロックを指定することが可能になす
    - ブロックの呼び出しが可能になる

【手段】
- ブロックハッシュ
    - 32 byte
    - ブロック識別しとして機能
    - ブロックヘッダに対して*SHA256を用いて2回*ハッシュ化した値
        →ブロックチェーン内にどのブロックハッシュがどのブロックを表現しているのかを紐づける情報は保存されていない
        →ブロックハッシュ値は各々のブロックヘッダから計算にすることでのみ導ける
        →クライアントソフト内で，検索高速化のために別DBで管理することはあり得る
        →前のブロックのブロックハッシュ値はヘッダー内に含まれている．

- ブロック高
    - ブロックチェーンがフォーク（枝分かれ）している際に一意に定まらない

 ##  genesis ブロック
 - ビットコインブロックチェーンの最初のブロック
    - genesisブロックのTimestampの値は2009-01-04 03:15
        →2009年に作られた
    - ブロックハッシュは000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f
    - coinbaseトランザクションにメッセージが含まれている
        - 「The Times 03/Jan/2009 Chancellor on brink of second bailout for banks.」という文字列
            - 英国タイムズ紙の2009年1月3日の見出し．
            - Genesisブロックがこれ以前には存在しなかったことの証明としてサトシ・ナカモトが入れた．

# マークルツリー

## マークルツリーの概要
【目的】
- そのブロックに含まれているトランザクションリストを一意に表現したい
- とあるトランザクションがそのブロックに含まれているかどうかを全トランザクションデータを用いなくても検証したい
    - SPVノードで使用される
    - マークルツリーの一部のみ使用すれば検証可能
    - ネットワーク転送量の削減につながる

【手段】
- ブロック内に含まれるトランザクション全体（値や順番）の要約を行う．
- →マークルルート
    - ブロックヘッダーに含まれている．
    - マークルツリーのルート：ハッシュ値
    - トランザクションリストのフィンガープリント
    -   トランザクションの順番や値が変更されるとマークルルートの値も変わる

## 
